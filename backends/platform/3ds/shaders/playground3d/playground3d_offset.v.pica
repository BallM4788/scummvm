; offset shader for playground3d in ScummVM

; Constants
.constf myConst(0.0, 1.0, 2.0, 0.5)
.alias ZEROES myConst.xxxx
.alias ONES   myConst.yyyy


; Inputs
.alias inPos v0


; Uniforms
.fvec    mvpMatrix[4] ; uniform mat4 mvpMatrix;
.fvec rotateMatrix[4] ; uniform mat4 rotateMatrix;
.fvec     modelPos    ; uniform vec3 modelPos;
.fvec  renderColor


; Outputs
.out outPos pos       ; gl_Position
.out outClr clr       ; out vec4 Color


; Main
.entry main
.proc main
	mov r0.xyz,     inPos
	mov r0.w,       ONES
	dp4 r1.x,       rotateMatrix[0], r0
	dp4 r1.y,       rotateMatrix[1], r0
	dp4 r1.z,       rotateMatrix[2], r0
	dp4 r1.w,       rotateMatrix[3], r0

	mov r0.xyz,     modelPos
	mov r0.w,       ONES
	add r1,         r1, r0
	dp4 r2.x,       mvpMatrix[0], r1
	dp4 r2.y,       mvpMatrix[1], r1
	dp4 r2.z,       mvpMatrix[2], r1
	dp4 r2.w,       mvpMatrix[3], r1

	; divide by w component
	rcp r3.w,       r2.w
	mul outPos,     r2, r3.w

	mov outClr.rgb,     renderColor
	mov outClr.a,       ONES

	end
.end
